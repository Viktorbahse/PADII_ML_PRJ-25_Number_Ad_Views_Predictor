# Запуск сервиса
Есть несколько вариантов запустить сервис:

- собрать docker-образ по инструкции в `README.md`
- запустить dev-версию проекта локально:

  1. Склонируйте репозиторий и перейдите в корень проекта.

  2. Установите зависимости для сервера:
     ```bash
     cd server
     pip install -r requirements.txt
     ```

  3. Установите зависимости для клиента:
     ```bash
     cd client
     pip install -r requirements.txt
     ```

  4. Запустите сервер (FastAPI):
     ```bash
     cd server
     uvicorn app:app --reload --host 0.0.0.0 --port 8000
     ```

  5. Запустите веб-сервис (Streamlit):
     ```bash
     cd client
     streamlit run app.py
     ```

# Класс `APIClient`

## Описание
Вспомогательное API для для взаимодействия с серверной частью.

---

## Инициализация

**Параметры:**
- `BASE_URL` — базовый URL API сервера (по умолчанию `http://127.0.0.1:8000`)

---

## Методы

#### `predict_one_item`
Отправляет данные о рекламном объявлении на сервер для предсказания результата.

**Аргументы:**
- `data`: объект типа `AddInput` с параметрами автомобиля.

**Возвращает:** JSON-словарь с результатами предсказаний для трех таргетов.

---

#### `set_active_model`
Устанавливает активную модель.

**Аргументы:**
- `model_name`: название модели.

**Возвращает:** `SetHandlerResponse` — результат установки активной модели.

---

#### `get_models`
Получает список всех доступных моделей с сервера.

**Возвращает:** JSON-словарь с названиями и параметрами моделей.

---

#### `predict_csv`
Отправляет данные из файла CSV на сервер для получения предсказаний.

**Аргументы:**
- `file`: байтовое представление CSV файла.

**Возвращает:** `SetHandlerResponse` — результат сохранения предсказаний в файл.

---


# Streamlit (client-side)

## Описание

Веб-интерфейс для предсказания количества просмотров рекламы, загрузки и обучения моделей.

---

## Основные функции

### Выбор активной модели
- Описание: Получение списка доступных моделей и установка активной модели.

### Загрузка датасета
- Описание: Загрузка CSV-файла с данными на сервер.

### Ввод параметров рекламного объявления
- Описание: Форма ввода информации об объявлении и предсказание доли пользователей, увидевших объявление 1, 2 и 3 раза.

### EDA (Exploratory Data Analysis)
- Описание:
  - Загрузка данных
  - Статистики некоторых признаков
  - Визуализация зависимостей (scatter, корреляция)
  - Распределения признаков
  - Анализ отдельного пользователя
 
### Расчет бюджета для заданного количества рекламных просмотров
- Описание: Функция для подсчета стоимости рекламных объявлений с заданными параметрами

---

# FastAPI (server-side)

## Описание

API для обработки данных, обучения моделей и предсказания цены автомобиля по его характеристикам.

---

## Основные функции

### `POST /set/{model_name}`

**Описание:** Установка активной модели для предсказаний  
**Параметры:**
- `model_name` — название сохранённой модели

---

### `POST /predict_one_item`

**Описание:** Предсказание доли пользователей, увидевших рекламу 1, 2 и 3 раза.
**Тело запроса:** JSON, соответствующий схеме `AddInput`

---

### `POST /predict_csv`

**Описание:** Предсказания для нескольких рекламных объявлений из файла CSV  
**Файл:** `UploadFile` (CSV, содержащий нужные признаки)

---

### `GET /models`

**Описание:** Получение списка обученных моделей и их параметров  

---

# Pydantic-модели

### AddInput
Входные данные о рекламном объявлении

| Поле | Тип | Описание |
| --- | --- | --- |
| cpm |	float	| Цена объявления для которой надо сделать прогноз |
| hour_start |	int |	Предположительное время запуска рекламного объявления |
| hour_end |	int	| Предположительное время остановки рекламного объявления |
| publishers |	str	| Площадки на которых объявление может быть показано |
| audience_size | int	| Размер аудитории объявления |
| user_ids | str | Аудитория объявления	|

---

### SetHandlerResponse
Ответ на установку активной модели

| Поле | Тип | Описание |
| --- | --- | --- |
| status | str | Статус ответа на запрос |
| active_model | str | Название активной модели |

---

### PredictOneItemHandlerResponse
Ответ на предсказание для одного объявления

| Поле | Тип | Описание |
| --- | --- | --- |
| model |	str |	Название модели |
| at_least_one |	float |	Предсказанная доля пользователей, увидевших объявление 1 раз |
| at_least_two |	float |	Предсказанная доля пользователей, увидевших объявление 2 раза |
| at_least_three |	float |		Предсказанная доля пользователей, увидевших объявление 3 раза |

---

### ModelsHandlerResponse
Ответ на запрос списка моделей

| Поле | Тип | Описание |
| --- | --- | --- |
| models | Dict[str, ModelInfo]	| Словарь моделей |

---

### User
Входные данные о пользователе

| Поле | Тип | Описание |
| --- | --- | --- |
| user_id | int	| Id пользователя |
| sex | int	| Пол пользователя |
| age | int	| Возраст пользователя |
| city_id | int	| Город пользователя |

---

### HistoryItem
Входные данные о пользователе

| Поле | Тип | Описание |
| --- | --- | --- |
| hour | int	| Час, когда объявление было просмотрено |
| cpm | confloat(ge=0)	| Стоимость объявления |
| publisher | int	| Платформа размещения объявления |
| user_id | int	| Id пользователя, просмотревшего объявление |
